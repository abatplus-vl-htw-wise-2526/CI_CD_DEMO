name: CI/CD Pipeline

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Repository auschecken
      uses: actions/checkout@v4

    - name: Repository Informationen ausgeben
      run: |
        echo "=== Repository wurde ausgecheckt ==="
        echo "Branch: ${{ github.ref }}"
        echo "Commit: ${{ github.sha }}"

    - name: Java JDK 11 einrichten
      uses: actions/setup-java@v4
      with:
        java-version: '11'
        distribution: 'temurin'
        cache: maven

    - name: Java Version anzeigen
      run: |
        echo "=== Java JDK wurde eingerichtet ==="
        java -version

    - name: Secret Wert anzeigen (Demo)
      run: |
        echo "=== Secret Demo ==="
        echo "Verwende Secret f체r Authentifizierung..."
        if [ -z "${{ secrets.DEMO_SECRET }}" ]; then
          echo "WARNUNG: DEMO_SECRET ist nicht gesetzt"
          echo "Bitte Secret 'DEMO_SECRET' in GitHub Repository Settings -> Secrets anlegen"
        else
          echo "Secret wurde erfolgreich geladen (Wert wird nicht angezeigt)"
          echo "Secret L채nge: ${#DEMO_SECRET} Zeichen"
        fi
      env:
        DEMO_SECRET: ${{ secrets.DEMO_SECRET }}

    - name: Maven Dependencies herunterladen
      run: |
        echo "=== Dependencies werden heruntergeladen ==="
        mvn dependency:resolve
        echo "Dependencies erfolgreich geladen"

    - name: Tests ausf체hren
      run: |
        echo "=== Starte Unit Tests ==="
        mvn test
        echo "=== Alle Tests erfolgreich bestanden ==="

    - name: Projekt kompilieren
      run: |
        echo "=== Starte Kompilierung ==="
        mvn clean compile
        echo "=== Kompilierung abgeschlossen ==="

    - name: JAR Artifact erstellen
      run: |
        echo "=== Erstelle JAR Artifact ==="
        mvn package -DskipTests
        echo "=== JAR Artifact erstellt ==="
        ls -lh target/*.jar

    - name: Build Informationen ausgeben
      run: |
        echo "=== Build Zusammenfassung ==="
        echo "Projekt: ci-cd-demo"
        echo "Version: 1.0.0"
        echo "Build Zeit: $(date)"
        echo "Artifact Pfad: target/ci-cd-demo-1.0.0.jar"

    - name: Artifact hochladen
      uses: actions/upload-artifact@v4
      with:
        name: ci-cd-demo-jar
        path: target/*.jar
        retention-days: 30

    - name: Artifact Upload Best채tigung
      run: |
        echo "=== Artifact wurde zu GitHub Actions hochgeladen ==="
        echo "Das Artifact kann nach dem Build heruntergeladen werden"

    - name: Build Abschluss
      run: |
        echo "==================================="
        echo "=== CI/CD Pipeline erfolgreich ==="
        echo "==================================="
